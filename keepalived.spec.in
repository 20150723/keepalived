Name: keepalived
Summary: HA monitor built upon LVS, VRRP and services poller
Packager: Christophe Varoqui, <christophe.varoqui@free.fr>
Version: @VERSION@
Release: 1
Source: http://www.keepalived.org/software/%{name}-%{version}.tar.gz
Copyright: GPL
Group: Applications/System
BuildRoot: /tmp/%{name}-%{version}.build

%define _exec_prefix /

%description
The main goal of the keepalived project is to add a strong & robust keepalive facility to the Linux Virtual Server project. This project is written in C with multilayer TCP/IP stack checks. Keepalived implements a framework based on three family checks : Layer3, Layer4 & Layer5. This framework gives the daemon the ability of checking a LVS server pool states. When one of the server of the LVS server pool is down, keepalived informs the linux kernel via a setsockopt call to remove this server entrie from the LVS topology. In addition keepalived implements a VRRPv2 stack to handle director failover. So in short keepalived is a userspace daemon for LVS cluster nodes healthchecks and LVS directors failover.

%prep
rm -rf %{buildroot}
%setup -q

%build
export CFLAGS=-D__KERNGLUE__
# the setting of mandir should be %{buildroot}/usr/share/man, but the
# makefile adds "man" itself.
./configure --prefix=%{buildroot} \
	--exec-prefix=%{buildroot} \
	--sysconfdir=%{buildroot}/etc \
	--with-kernel-dir=/lib/modules/$(uname -r)/build \
	--mandir=%{buildroot}/usr/share \
	--enable-syncd
make

%install
rm -rf %{buildroot}
%makeinstall
rm -rf %{buildroot}/etc/keepalived/samples

%clean
rm -rf %{buildroot}

%post
/sbin/chkconfig --add keepalived

%preun
/sbin/chkconfig --del keepalived

%files
%defattr(-,root,root)
%{_bindir}/genhash
%{_sbindir}/keepalived
%{_sysconfdir}/init.d/keepalived
%dir %{_sysconfdir}/keepalived/
%config %{_sysconfdir}/keepalived/keepalived.conf
%doc %{_mandir}/man5/keepalived.conf.5.gz
%doc %{_mandir}/man1/genhash.1.gz
%doc %{_mandir}/man8/keepalived.8.gz
%doc doc
%doc AUTHOR CONTRIBUTORS TODO COPYING README INSTALL VERSION ChangeLog
